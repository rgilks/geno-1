<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Geno-1</title>
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        background: #020308;
      }
      #app-canvas {
        width: 100vw;
        height: 100vh;
        display: block;
        touch-action: none;
      }
      #start-overlay {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(2, 3, 8, 0.25);
        backdrop-filter: blur(6px) saturate(1.1);
        z-index: 10;
      }
      #start-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        text-align: center;
        color: #cfe7ff;
      }
      #start-keys {
        color: #cfe7ff;
        font:
          13px/1.55 system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Ubuntu,
          Cantarell,
          Noto Sans,
          Arial,
          sans-serif;
        max-width: 760px;
        background: rgba(10, 14, 24, 0.7);
        padding: 16px 18px;
        border: 1px solid rgba(80, 110, 150, 0.35);
        border-radius: 10px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
        text-align: left;
      }
      #start-keys h3 {
        margin: 0 0 8px 0;
        font-size: 13px;
        font-weight: 700;
        color: #a9c6ff;
        letter-spacing: 0.02em;
        text-transform: uppercase;
      }
      #start-keys .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px 18px;
      }
      #start-keys ul {
        list-style: none;
        margin: 6px 0 10px 0;
        padding: 0;
        color: #9bb;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 12px;
      }
      #start-keys li {
        margin: 4px 0;
      }
      .kbd {
        display: inline-block;
        padding: 1px 6px;
        border-radius: 6px;
        border: 1px solid rgba(120, 150, 190, 0.35);
        background: rgba(18, 24, 38, 0.8);
        color: #cfe7ff;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 12px;
      }
      #overlay-ok,
      #overlay-close {
        appearance: none;
        border: 1px solid #3a4b66;
        background: linear-gradient(#0b1220, #0a0f1a);
        color: #cfe7ff;
        font:
          600 14px system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Ubuntu,
          Cantarell,
          Noto Sans,
          Arial,
          sans-serif;
        padding: 8px 14px;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.35);
      }
      #overlay-ok:hover,
      #overlay-close:hover {
        filter: brightness(1.1);
      }
      #overlay-ok:active,
      #overlay-close:active {
        transform: translateY(1px);
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "env": "./pkg/env.js"
        }
      }
    </script>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  </head>
  <body>
    <div id="start-overlay">
      <div id="start-content">
        <div id="start-keys">
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              margin-bottom: 6px;
            "
          >
            <div
              style="
                font:
                  800 20px/1.2 &quot;Inter&quot;,
                  system-ui;
                letter-spacing: 0.02em;
                color: #eaf2ff;
              "
            >
              Geno-1
            </div>
            <div>
              <button id="overlay-close" aria-label="Close">×</button>
            </div>
          </div>
          <h3>Welcome</h3>
          <ul>
            <li>
              Click the canvas to play a note. Mouse position shapes the sound.
            </li>
          </ul>
          <div class="grid">
            <div>
              <h3>Keys</h3>
              <ul>
                <li><span class="kbd">A..F</span>: set root note</li>
                <li><span class="kbd">1..7</span>: set mode (see right)</li>
                <li><span class="kbd">R</span>: new sequence</li>
                <li><span class="kbd">T</span>: random root + mode</li>
                <li><span class="kbd">Space</span>: pause/resume</li>
                <li>
                  <span class="kbd">Enter</span>/<span class="kbd">Esc</span>:
                  full/exit screen
                </li>
                <li>
                  <span class="kbd">←/→</span>: tempo •
                  <span class="kbd">↑/↓</span>: volume
                </li>
              </ul>
            </div>
            <div>
              <h3>Modes (1..7)</h3>
              <ul>
                <li><span class="kbd">1</span>: Ionian (major)</li>
                <li><span class="kbd">2</span>: Dorian</li>
                <li><span class="kbd">3</span>: Phrygian</li>
                <li><span class="kbd">4</span>: Lydian</li>
                <li><span class="kbd">5</span>: Mixolydian</li>
                <li><span class="kbd">6</span>: Aeolian (natural minor)</li>
                <li><span class="kbd">7</span>: Locrian</li>
              </ul>
            </div>
          </div>
          <div
            style="display: flex; justify-content: flex-end; margin-top: 8px"
          >
            <button id="overlay-ok">OK</button>
          </div>
        </div>
      </div>
    </div>
    <canvas id="app-canvas" width="1280" height="720"></canvas>
    <div
      id="audio-error"
      style="
        display: none;
        color: #caa;
        font: 14px/1.4 system-ui;
        position: fixed;
        left: 12px;
        top: 88px;
        max-width: 560px;
        background: rgba(20, 20, 30, 0.7);
        padding: 10px 12px;
        border-radius: 6px;
      "
    >
      Audio initialization failed (AudioContext). If audio permissions were
      denied or you are in a headless environment, audio will not play.
    </div>
    <div
      id="no-webgpu"
      style="
        display: none;
        color: #caa;
        font: 14px/1.4 system-ui;
        position: fixed;
        left: 12px;
        top: 12px;
        max-width: 560px;
        background: rgba(20, 20, 30, 0.7);
        padding: 10px 12px;
        border-radius: 6px;
      "
    >
      This demo requires WebGPU. Your browser either does not support it or it
      is disabled.<br />
      Try Chrome 113+ or Edge 113+ with WebGPU enabled.
    </div>
    <script type="module">
      const v = Date.now();
      console.log("[index] dynamic import cache-bust tag:", v);
      if (!("gpu" in navigator)) {
        const el = document.getElementById("no-webgpu");
        if (el) el.style.display = "block";
      }
      import(`./pkg/app_web.js?v=${v}`).then((m) => {
        console.log(
          "[index] wasm entry loaded url:",
          new URL(`./pkg/app_web.js?v=${v}`, window.location.href).toString()
        );
        return m.default();
      });
    </script>
  </body>
</html>
